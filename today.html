<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å½“æ—¥å‚åŠ  - ç¸æ—¥é£Ÿå ‚</title>
  <link rel="stylesheet" href="css_style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>ä»Šæœˆã®å‚åŠ ï¼ˆåˆå›ç™»éŒ²æ¸ˆã¿ã®æ–¹ï¼‰</h1>
      <a href="index.html" class="back-link">â† æˆ»ã‚‹</a>
    </header>

    <main>
      <form id="todayForm" class="form">
        <div class="form-group">
          <label for="name">ãŠåå‰ <span class="required">*</span></label>
          <input type="text" id="name" name="name" required placeholder="å±±ç”°å¤ªéƒ">
        </div>

        <!-- åŒºåˆ†é¸æŠ -->
        <div class="form-group">
          <label>åŒºåˆ† <span class="required">*</span></label>
          <div class="category-buttons">
            <button type="button" class="category-btn" data-category="å­¦ç”Ÿ" data-price="500">
              <span class="category-label">ğŸ“ å­¦ç”Ÿ</span>
              <span class="category-price">500å††</span>
            </button>
            <button type="button" class="category-btn" data-category="ç¤¾ä¼šäºº" data-price="2000">
              <span class="category-label">ğŸ’¼ ç¤¾ä¼šäºº</span>
              <span class="category-price">2,000å††</span>
            </button>
          </div>
          <input type="hidden" id="category" name="category" required>
          <input type="hidden" id="price" name="price">
        </div>

        <!-- æ–™é‡‘è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="price-display" id="priceDisplay" style="display: none;">
          <div class="price-label">ğŸ’° ãŠæ”¯æ‰•ã„æ–™é‡‘</div>
          <div class="price-amount" id="totalPrice">0å††</div>
          <div class="price-note">â€»å½“æ—¥å—ä»˜ã§ãŠæ”¯æ‰•ã„ãã ã•ã„</div>
        </div>

        <button type="submit" class="button button-submit" id="submitBtn">
          <span class="loading-spinner" style="display: none;">â³</span>
          <span class="submit-text">å—ä»˜ã™ã‚‹</span>
        </button>
      </form>
    </main>
  </div>

  <script src="js_config.js"></script>
  <script src="js_submit.js"></script>
  <script>
    let selectedCategory = '';
    let selectedPrice = 0;

    // åŒºåˆ†ãƒœã‚¿ãƒ³ã®å‡¦ç†
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
        document.querySelectorAll('.category-btn').forEach(b => 
          b.classList.remove('active'));
        
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        this.classList.add('active');
        
        // é¸æŠã•ã‚ŒãŸåŒºåˆ†ã¨æ–™é‡‘ã‚’å–å¾—
        selectedCategory = this.dataset.category;
        selectedPrice = parseInt(this.dataset.price);
        
        // hidden inputã«å€¤ã‚’è¨­å®š
        document.getElementById('category').value = selectedCategory;
        document.getElementById('price').value = selectedPrice;
        
        // æ–™é‡‘è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’æ›´æ–°ã—ã¦è¡¨ç¤º
        document.getElementById('totalPrice').textContent = 
          selectedPrice.toLocaleString() + 'å††';
        document.getElementById('priceDisplay').style.display = 'block';
      });
    });

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    document.getElementById('todayForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // åŒºåˆ†ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
      if (!selectedCategory) {
        alert('åŒºåˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      const spinner = submitBtn.querySelector('.loading-spinner');
      const submitText = submitBtn.querySelector('.submit-text');
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      submitBtn.disabled = true;
      spinner.style.display = 'inline-block';
      submitText.textContent = 'é€ä¿¡ä¸­...';

      try {
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const formData = {
          type: 'ä»Šæœˆå‚åŠ ',  // âœ… å›ºå®šå€¤ã«å¤‰æ›´
          name: document.getElementById('name').value,
          category: selectedCategory,
          price: selectedPrice,
          contact: '',
          memo: ''
        };

        // Google Formsã¸é€ä¿¡
        await submitToGoogleForm(formData);
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        saveToLocalStorage(formData);
        
        // âœ… å®Œäº†ãƒšãƒ¼ã‚¸ã¸é·ç§»ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ ï¼‰
        location.href = 'complete.html?name=' + encodeURIComponent(formData.name) + 
                        '&category=' + encodeURIComponent(formData.category) + 
                        '&price=' + selectedPrice;
        
      } catch (error) {
        alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚\n' + error.message);
        
        // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
        submitBtn.disabled = false;
        spinner.style.display = 'none';
        submitText.textContent = 'å—ä»˜ã™ã‚‹';
      }
    });
  </script>
</body>
</html>
